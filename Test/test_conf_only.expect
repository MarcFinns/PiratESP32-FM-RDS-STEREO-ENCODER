#!/usr/bin/expect

# Test only SYST:CONF:* commands
set timeout 3
set device "/dev/tty.usbmodem5AAF1766471"
set baud 115200

spawn screen $device $baud
set port_id $spawn_id
sleep 1

puts "Testing SYST:CONF:* Commands"
puts "=============================="
puts ""

# Disable logging
send "SYST:LOG:LEVEL OFF\r"
sleep 0.5
expect "OK"
puts "✓ Logging disabled"
sleep 1

# Test CONF commands one by one with debugging
puts ""
puts "Test 1: SYST:CONF:DEFAULT"
send "SYST:CONF:DEFAULT\r"
sleep 0.6
expect {
    timeout {
        puts "✗ TIMEOUT"
    }
    "OK" {
        puts "✓ OK received"
    }
}

sleep 1

puts ""
puts "Test 2: SYST:CONF:SAVE test_config"
send "SYST:CONF:SAVE test_config\r"
sleep 0.6
expect {
    timeout {
        puts "✗ TIMEOUT"
    }
    "OK" {
        puts "✓ OK received"
    }
}

sleep 1

puts ""
puts "Test 3: SYST:CONF:LIST?"
send "SYST:CONF:LIST?\r"
sleep 0.6
expect {
    timeout {
        puts "✗ TIMEOUT"
    }
    "OK" {
        puts "✓ OK received (with config list)"
    }
}

sleep 1

puts ""
puts "Test 4: SYST:CONF:ACTIVE?"
send "SYST:CONF:ACTIVE?\r"
sleep 0.6
expect {
    timeout {
        puts "✗ TIMEOUT"
    }
    "OK" {
        puts "✓ OK received"
    }
}

sleep 1

puts ""
puts "Test 5: SYST:CONF:DELETE test_config"
send "SYST:CONF:DELETE test_config\r"
sleep 0.6
expect {
    timeout {
        puts "✗ TIMEOUT"
    }
    "OK" {
        puts "✓ OK received"
    }
}

exit
